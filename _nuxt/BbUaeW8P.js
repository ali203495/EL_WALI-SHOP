import{_ as R}from"./B-8L2Q9z.js";import{_ as W}from"./CgFVh808.js";import{d as j,u as G,m as H,r as b,B as Q,A as x,a as U,c as l,b as i,e as t,C as N,h as s,w as B,t as e,F as C,i as J,f as K,_ as X,n as v,G as E,g as p,q as Y,D as T,L as Z,j as tt}from"./CKlka8Zi.js";import"./Y6lJhnZ0.js";const st={class:"pos-container"},et={class:"error-details",style:{color:"white",opacity:"0.7"}},ot={class:"products-area"},at={class:"pos-header"},nt={class:"products-grid"},ct=["id","onClick"],it=["src","alt"],rt={class:"product-details"},lt={key:0,class:"product-brand"},dt={class:"product-meta"},ut={class:"product-price"},_t={key:0,class:"empty-state",style:{"grid-column":"1/-1","text-align":"center",color:"white",padding:"4rem"}},pt={class:"cart-panel"},mt={class:"cart-header"},ht={class:"cart-items"},yt={key:0,class:"empty-cart"},vt={class:"hint"},ft=["id"],gt=["src"],kt={class:"cart-item-info"},bt={class:"cart-item-name"},xt={class:"cart-item-price"},Ct={class:"quantity-controls"},wt=["onClick"],$t=["id"],qt=["onClick"],St={class:"cart-summary"},Lt={class:"summary-row"},Nt={class:"summary-row"},Bt={class:"summary-row total"},Et=["disabled"],Tt={key:0},At={key:1},Ot={key:2},Pt=j({__name:"index",async setup(Vt){let m,w;const{translateLanguage:n}=G(),$=H(),r=b([]),h=b(!1),f=b(!1),{data:g,pending:A,error:y,refresh:O}=([m,w]=Q(()=>$.getProducts()),m=await m,w(),m),P=()=>{O()},V=c=>{const a=r.value.find(_=>_.product.id===c.id);a?(a.quantity++,p.fromTo(`#qty-${c.id}`,{scale:1.3,color:"#4f46e5"},{scale:1,color:"#0f172a",duration:.3})):(r.value.push({product:c,quantity:1}),Z(()=>{p.from(`#cart-item-${c.id}`,{x:-30,opacity:0,duration:.4,ease:"back.out(1.7)"})}));const d=document.getElementById(`product-${c.id}`);d&&p.to(d,{scale:.95,duration:.1,yoyo:!0,repeat:1,ease:"power2.inOut"})},F=c=>{const a=r.value.findIndex(d=>d.product.id===c);a>-1&&p.to(`#cart-item-${c}`,{x:50,opacity:0,duration:.3,onComplete:()=>{r.value.splice(a,1)}})},q=(c,a)=>{const d=r.value.find(_=>_.product.id===c);d&&(d.quantity+=a,d.quantity<=0&&F(c))},k=x(()=>r.value.reduce((c,a)=>c+a.product.price*a.quantity,0)),S=x(()=>k.value*.08),z=x(()=>k.value+S.value),D=async()=>{if(r.value.length===0)return;h.value=!0;const c=r.value.map(a=>({product_id:a.product.id,quantity:a.quantity}));try{await $.createOrder({items:c,email:"pos@elwali.shop",firstName:"POS",lastName:"Customer",address:"Store POS",city:"Store",country:"UAE",zip:"00000"}),f.value=!0,r.value=[],setTimeout(()=>{f.value=!1},3e3)}catch{alert(n("pos.order_error"))}finally{h.value=!1}},I=()=>{p.to(".cart-item",{x:50,opacity:0,stagger:.05,duration:.2,onComplete:()=>{r.value=[]}})},u=c=>`${c.toLocaleString()} ${n("common.currency")}`;return U({title:`Maison El Wali | ${n("pos.title")}`}),(c,a)=>{const d=R,_=W,M=X;return i(),l("div",st,[a[1]||(a[1]=t("div",{class:"blob blob-1"},null,-1)),a[2]||(a[2]=t("div",{class:"blob blob-2"},null,-1)),s(A)?(i(),N(d,{key:0,message:s(n)("admin.loading_data")},null,8,["message"])):s(y)?(i(),N(_,{key:1,icon:"ðŸ›’",title:s(n)("admin.failed_load"),description:s(n)("common.error_desc"),retryable:!0,onRetry:P},{footer:B(()=>[t("div",et,e(s(y).message||s(y).statusText||s(y)),1)]),_:1},8,["title","description"])):(i(),l(C,{key:2},[t("div",ot,[t("div",at,[t("h1",null,e(s(n)("pos.title")),1),J(M,{to:"/admin",class:"btn btn-outline btn-sm"},{default:B(()=>[K("â† "+e(s(n)("pos.back_to_admin")),1)]),_:1})]),t("div",nt,[(i(!0),l(C,null,E(s(g)||[],o=>(i(),l("div",{id:`product-${o.id}`,key:o.id,class:"product-tile",onClick:L=>V(o)},[t("img",{src:o.image_url,alt:o.name,class:"product-image"},null,8,it),t("div",rt,[o.brand?(i(),l("span",lt,e(o.brand.name),1)):v("",!0),t("h3",null,e(o.name),1),t("div",dt,[t("span",ut,e(u(o.price)),1),t("span",{class:Y(["product-stock",{low:o.stock<20}])},e(o.stock)+" "+e(s(n)("pos.left")),3)])])],8,ct))),128)),!s(g)||s(g).length===0?(i(),l("div",_t,[t("p",null,e(s(n)("admin.no_data")),1)])):v("",!0)])]),t("div",pt,[t("div",mt,[t("h2",null,e(s(n)("pos.current_order")),1),r.value.length>0?(i(),l("button",{key:0,class:"clear-btn",onClick:I},e(s(n)("pos.clear_all")),1)):v("",!0)]),t("div",ht,[r.value.length===0?(i(),l("div",yt,[a[0]||(a[0]=t("span",{class:"empty-icon"},"ðŸ›’",-1)),t("p",null,e(s(n)("pos.cart_empty")),1),t("p",vt,e(s(n)("pos.add_hint")),1)])):v("",!0),(i(!0),l(C,null,E(r.value,o=>(i(),l("div",{id:`cart-item-${o.product.id}`,key:o.product.id,class:"cart-item"},[t("img",{src:o.product.image_url,class:"cart-thumb"},null,8,gt),t("div",kt,[t("span",bt,e(o.product.name),1),t("span",xt,e(u(o.product.price*o.quantity)),1)]),t("div",Ct,[t("button",{onClick:T(L=>q(o.product.id,-1),["stop"])},"âˆ’",8,wt),t("span",{id:`qty-${o.product.id}`},e(o.quantity),9,$t),t("button",{onClick:T(L=>q(o.product.id,1),["stop"])},"+",8,qt)])],8,ft))),128))]),t("div",St,[t("div",Lt,[t("span",null,e(s(n)("pos.subtotal")),1),t("span",null,e(u(k.value)),1)]),t("div",Nt,[t("span",null,e(s(n)("pos.tax"))+" (8%)",1),t("span",null,e(u(S.value)),1)]),t("div",Bt,[t("span",null,e(s(n)("pos.total")),1),t("span",null,e(u(z.value)),1)]),t("button",{class:"checkout-btn",disabled:r.value.length===0||h.value,onClick:D},[h.value?(i(),l("span",Tt,e(s(n)("pos.processing")),1)):f.value?(i(),l("span",At,e(s(n)("pos.order_placed")),1)):(i(),l("span",Ot,e(s(n)("pos.complete_order")),1))],8,Et)])])],64))])}}}),Mt=tt(Pt,[["__scopeId","data-v-a7a6fe1f"]]);export{Mt as default};
